<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
<script src="http://maps.googleapis.com/maps/api/js"></script>
<!-- <script src="http://maps.google.com/maps/api/js?sensor=false"></script> -->
<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.12.0.min.js"></script>
<script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
</head>

<body>
<!-- <div id="googleMap" style="width:500px;height:380px;"></div> -->
<div id="googleMap" style="width:1000px;height: 500px"></div>
<div style="width: 500px; height: 100px">
	<input id="startTime" type="datetime-local" name="startTime" step=1>
	<input id="endTime" type="datetime-local" name="endTime" step=1>
	<!-- <input id="tiemSubmit" type="submit" value="Submit"> -->
</div>
<!-- <div id="time" style="width:600px; height: 40px">
  <input type="range" name="points" id="slidebar" value="-50" min="-100" max="10">
</div> -->
<div> What Do You Want To Search: </div>
<div id="search" style="width:500px;height:100px">
  <input type="text" id="keyword" id="keyword" value="" placeholder="keyword">
</div>
<div id="demo"></div>
<div id="demo1"></div>
<div id="demo2"></div>
<div id="demo3"></div>

<script>
  var x = document.getElementById("location");
  var map;
  var locations = [];
  var markers = [];
  $(document).ready(function(){
      openmap();
      setInterval(function(){ locationRequest(); }, 1000);
      // locationRequest();
  })

  function locationRequest(){
    var startTime = document.getElementById("startTime").value;
    
    var endTime = document.getElementById("endTime").value;
    document.getElementById("demo2").innerHTML=endTime;
    var keyword = document.getElementById("keyword").value;
    document.getElementById("demo3").innerHTML=keyword;
    var xhttp = new XMLHttpRequest();
    var url = keyword + "?" + startTime + "," + endTime;
    document.getElementById("demo").innerHTML=url;
    xhttp.open("SIGNUP", url, true);
    xhttp.onreadystatechange = function(){
      if(xhttp.readyState==4&&xhttp.status==200){
        text = xhttp.responseText;
        document.getElementById("demo1").innerHTML=text;
        locations = [];
        if(text.length>0){
        	obj = JSON.parse(text);
	        length = Object.keys(obj).length;
	        for(var i=0; i<length; i++){
	          locations[i] = [obj[i].latitude, obj[i].longitude];
	        }
        }
        
        markmap();
      }
    }
    xhttp.send(null); 
  }


  function openmap()
  {
    var myCenter=new google.maps.LatLng(41.079351,-73.125000);
    var mapProp = {
      center: myCenter,
      zoom:2,
      mapTypeId: google.maps.MapTypeId.ROADMAP
      };

    map = new google.maps.Map(document.getElementById("googleMap"),mapProp);
  }
  

  function markmap()
  {
    var iconURLPrefix = 'http://maps.google.com/mapfiles/ms/icons/';
						    
    var icons = 'https://maps.gstatic.com/intl/en_us/mapfiles/markers2/measle_blue.png';			      
    
    // var oldMarkers = [];
    // for (var j = 0; j<markers.length; j++){
    //   oldMarkers.push(markers[j]);
    // }

    for (var k = 0; k<markers.length; k++){
      markers[k].setMap(null);
    }
    // Add the markers and infowindows to the map
    for (var i = 0; i < locations.length; i++) {  
  		var marker = new google.maps.Marker({
			position: new google.maps.LatLng(locations[i][0], locations[i][1]),
			// animation: google.maps.Animation.BOUNCE,
			map: map,
			icon: icons
			});
		  markers.push(marker);
      // marker.setMap(map);
    }
    
    
    
    


    // alert(oldMarkers)
    // for(var i=0; i<oldMarkers.length; i++){
    //   oldMarkers[i].setMap(null);
    //   // oldMarkers.length = 0;
    // }
    // for(var i=0; i<markers.length; i++){
    //   markers[i].setMap(map);
    //   oldMarkers[i] = markers[i];
    //   // markers[i].setMap(null);
    // }
  //   var bounds = new google.maps.LatLngBounds();
  //   for (var i = 0; i < markers.length; i++) {  
		//   bounds.extend(markers[i].position);
		// }
  //   map.fitBounds(bounds);
  }

  
</script>
</body>
</html>